<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek AI èŠå¤©åŠ©æ‰‹</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¤–</text></svg>">
</head>
<body>
    <div class="container">
        <header>
            <h1>DeepSeek AI èŠå¤©åŠ©æ‰‹</h1>
            <div class="status" id="status-indicator">æ­£åœ¨è¿æ¥æœåŠ¡...</div>
        </header>
        
        <div id="chat-box" class="chat-box"></div>
        
        <div class="input-area">
            <input 
                type="text" 
                id="message-input" 
                placeholder="è¾“å…¥æ¶ˆæ¯..." 
                autocomplete="off"
                disabled
            >
            <button id="send-btn" disabled>
                <span>å‘é€</span>
                <span class="loading-spinner" id="spinner" style="display:none"></span>
            </button>
        </div>
        
        <footer>
            <p>ppap</p>
        </footer>
    </div>

    <script>
        // DOMå…ƒç´ å¼•ç”¨
        const chatBox = document.getElementById('chat-box');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const statusIndicator = document.getElementById('status-indicator');
        const spinner = document.getElementById('spinner');
        
        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        async function checkServiceStatus() {
            try {
                statusIndicator.textContent = "æ£€æŸ¥æœåŠ¡çŠ¶æ€...";
                const response = await fetch('/api/health');
                
                if (!response.ok) {
                    throw new Error(`æœåŠ¡ä¸å¯ç”¨: ${response.status}`);
                }
                
                const data = await response.json();
                statusIndicator.textContent = `æœåŠ¡çŠ¶æ€: ${data.status} | Python ${data.python_version}`;
                statusIndicator.className = 'status active';
                
                // å¯ç”¨è¾“å…¥
                messageInput.disabled = false;
                sendBtn.disabled = false;
                messageInput.placeholder = "è¾“å…¥æ¶ˆæ¯...";
                messageInput.focus();
                
                // åˆå§‹é—®å€™
                addMessage('ai', 'ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ');
                
            } catch (error) {
                statusIndicator.textContent = `æœåŠ¡ç¦»çº¿: ${error.message}`;
                statusIndicator.className = 'status error';
                addMessage('ai', 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚');
            }
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©æ¡†
        function addMessage(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || messageInput.disabled) return;
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            addMessage('user', message);
            messageInput.value = '';
            
            // ç¦ç”¨è¾“å…¥å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            messageInput.disabled = true;
            sendBtn.disabled = true;
            spinner.style.display = 'inline-block';
            
            try {
                // å‘é€è¯·æ±‚
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `è¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                addMessage('ai', data.reply);
                
            } catch (error) {
                addMessage('ai', `é”™è¯¯: ${error.message}`);
            } finally {
                // æ¢å¤è¾“å…¥
                messageInput.disabled = false;
                sendBtn.disabled = false;
                spinner.style.display = 'none';
                messageInput.focus();
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        // åˆå§‹åŒ–
        window.onload = checkServiceStatus;
    </script>
</body>
</html>